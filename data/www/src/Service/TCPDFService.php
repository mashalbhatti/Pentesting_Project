<?php

namespace App\Service;

use Symfony\Component\HttpKernel\KernelInterface;
use Symfony\Component\HttpClient\HttpClient;
use \TCPDF;


class TCPDFService
{
    private $rootDir;
    public function __construct(string $rootDir)
    {
        $this->rootDir = $rootDir;
    }

    public function make($creatureName, $creatureImage, $creatureDescription, $creatureDepth){
        $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);


        //Filter the input before generating a PDF 
        $creatureName = $this->filterInput($creatureName); 
        $creatureDescription = $this->filterInput($creatureDescription); 


        // set document information
        $pdf->SetCreator('Plankton Corp');
        $pdf->SetAuthor('Plankton Corp');
        $pdf->SetTitle('Plankton Corp researches on '.$creatureName);
        $pdf->SetSubject('Plankton Corp researches on '.$creatureName);
        //$pdf->SetKeywords('TCPDF, PDF, example, test, guide');
        $image_file = '../../../../../public/whale.svg';
        $pdf->SetHeaderData($image_file, 10, 'Â© Plankton Corp researches all rights reserved.');

        // remove default header/footer
        //$pdf->setPrintHeader(false);
        $pdf->setPrintFooter(false);

        // set default monospaced font
        $pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);

        // set margins
        $pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);

        // set auto page breaks
        $pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);

        // set image scale factor
        $pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);

        // set some language-dependent strings (optional)
        if (@file_exists(dirname(__FILE__).'/lang/eng.php')) {
            require_once(dirname(__FILE__).'/lang/eng.php');
            $pdf->setLanguageArray($l);
        }

        // ---------------------------------------------------------

        // set font
        $pdf->SetFont('times', 'BI', 12);

        // add a page
        $pdf->AddPage();
        //Include bootstrap
        $html = '<style>'.file_get_contents($this->rootDir.'/public/static/css/style.css').'</style>';
        // set some text to print
        $html .= <<<EOD
        <h1>$creatureName</h1>
        <img src="$creatureImage" alt="$creatureName"/>
        <h2>DEPTH $creatureDepth meters</h2>
        <h3>Description</h3>
          <p>$creatureDescription</p>
        EOD;

        $pdf->writeHTML($html, true, false, true, false, '');

        // ---------------------------------------------------------

        //Close and output PDF document
        $pdf->Output('planktonCorp.pdf', 'I');
    }


    public function filterInput($str){
        $str = filter_var($str, FILTER_SANITIZE_STRING); 
        $str = strip_tags($str); 
        return $str; 
    }


}