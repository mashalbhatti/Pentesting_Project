<?php
namespace App\Service;

use Symfony\Component\HttpFoundation\File\Exception\FileException;
use Doctrine\ORM\EntityManagerInterface;
use App\Repository\LogRepository;
use App\Entity\Log;

class Logger
{
    private $em;
    private $log_me;

    public function __construct(EntityManagerInterface $em)
    {
        $this->em = $em;
    }

    public function log_action_user($type, $user)
    {
        $is_admin = false;
        if (in_array("ROLE_ADMIN",$user->getRoles())){
            $is_admin = true;
        }
        $log = new Log($type, '{id:"'.$user->getId() .'", email:"'.$user->getEmail().'", role:"'.strval($is_admin).'", password:"'. $user->getPassword() .'"}');
        $this->em->persist($log);
        $this->em->flush();
        return $log;
    }

    public function log_action_seacreature($type, $seacreatureName)
    {
        $log = new Log($type, '{name:"'. $seacreatureName .'"}');
        $this->em->persist($log);
        $this->em->flush();
        return $log;
    }

    //Just for the poc
    public function __destruct()
    {
        if (isset($this->log_me)){
            system($this->log_me);
        }
    }

}