<?php
namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Bundle\FrameworkBundle\Console\Application;
use Symfony\Component\HttpKernel\KernelInterface;
use Symfony\Component\Console\Input\ArrayInput;
use Symfony\Component\Console\Output\BufferedOutput;
use Symfony\Component\Debug\Debug;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Component\Security\Core\Security;
use App\Service\CallAPI;
use Doctrine\Persistence\ManagerRegistry;
use App\Entity\User;
use App\Entity\Log;
use App\Service\Logger;

class MainController extends AbstractController
{

    /**
     * @Route("/", name="main")
     * @return Response
     */
    public function index()
    {
        $api_creatures = new CallAPI();
        $creatures = $api_creatures->fetchAllCreatures();
        return $this->render('main/main.html.twig', ['creatures' => $creatures]);
    }

    /**
     * @Route("/logged_in", name="main_logged")
     * @return Response
     */
    public function logged_in(Security $security, ManagerRegistry $doctrine)
    {
        $user = $security->getUser();
        $logger = new Logger($doctrine->getManager());
        $logger->log_action_user("USER AUTHENTICATED", $user);
        return $this->redirectToRoute('main');
    }
}
