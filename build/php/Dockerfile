FROM php:7.3-fpm-alpine

USER root

RUN apk add shadow

RUN apk add curl

RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/bin --filename=composer

RUN usermod -u 1000 www-data

RUN cd /var/www/html

ADD ./composer.json /var/www/html/composer.json

RUN composer install 
RUN composer clearcache

RUN docker-php-ext-install mysqli pdo pdo_mysql

RUN php /var/www/html/bin/console cache:clear --no-warmup --env=dev

RUN chown -R www-data:www-data /var/www/html

RUN chmod -R 777 /var/www/html/var/log

USER www-data

RUN composer require symfony/security-bundle
RUN composer require symfony/http-client

#RUN mkdir /var/www/html/src/DataFixtures

ADD ./UserFixtures.php /var/www/html/src/DataFixtures/UserFixtures.php

RUN composer require tecnickcom/tcpdf:6.2.21

#RUN php bin/console doctrine:migrations:migrate

#RUN composer require --dev doctrine/doctrine-fixtures-bundle

#RUN php bin/console doctrine:fixtures:load

CMD php-fpm
